package com.vista.security.core;

/**
 * Built-in vulnerability testing templates for VISTA.
 * Provides focused guidance for specific vulnerability categories.
 */
public final class VulnerabilityTemplates {
    
    private VulnerabilityTemplates() {
        // Utility class - prevent instantiation
    }
    
    public static final String CSRF = """
        CSRF Testing Guide:
        
        1. TOKEN ANALYSIS
           - Check for CSRF token presence in forms/headers
           - Test token validation: remove, empty, different user's token
           - Check if token is tied to session
        
        2. HEADER CHECKS
           - Test without Origin/Referer headers
           - Modify Origin to attacker domain
           - Check SameSite cookie attribute
        
        3. BYPASS TECHNIQUES
           - JSON content-type with form submission
           - Method override (_method parameter)
           - Flash-based CSRF for complex requests
           - Subdomain trust exploitation
        
        4. VERIFICATION
           - Create PoC HTML form
           - Test state-changing action succeeds
           - Confirm no additional auth required
        
        PAYLOADS:
        - Remove token entirely
        - Set token to empty string
        - Use token from different session
        - Predictable token patterns
        """;

    public static final String IDOR = """
        IDOR Testing Guide:
        
        1. IDENTIFIER DISCOVERY
           - Numeric IDs: increment/decrement
           - UUIDs: check if predictable or leaked
           - Encoded values: base64, hex decode
           - Composite keys: user_id + resource_id
        
        2. ACCESS PATTERNS
           - Horizontal: same role, different user
           - Vertical: lower role accessing higher
           - Context-based: different tenant/org
        
        3. PARAMETER LOCATIONS
           - URL path: /api/users/123
           - Query string: ?id=123
           - Request body: {"user_id": 123}
           - Headers: X-User-ID
           - Cookies: user session data
        
        4. BYPASS TECHNIQUES
           - Array injection: id[]=1&id[]=2
           - JSON type juggling: "123" vs 123
           - Wrapped objects: {"id": {"$gt": 0}}
           - Parameter pollution
        
        VERIFICATION:
        - Access another user's data
        - Modify another user's resources
        - Delete unauthorized resources
        """;

    public static final String SQL_INJECTION = """
        SQL Injection Testing Guide:
        
        1. DETECTION
           - Single quote: ' (error-based)
           - Boolean: ' AND '1'='1 vs ' AND '1'='2
           - Time-based: ' AND SLEEP(5)--
           - UNION: ' UNION SELECT NULL--
        
        2. DATABASE-SPECIFIC
           MySQL:
           - Comment: -- , #, /**/
           - Version: @@version
           - Sleep: SLEEP(5)
           
           MSSQL:
           - Comment: --
           - Version: @@version
           - Sleep: WAITFOR DELAY '0:0:5'
           
           PostgreSQL:
           - Comment: --
           - Version: version()
           - Sleep: pg_sleep(5)
           
           Oracle:
           - Comment: --
           - Version: banner FROM v$version
           - Sleep: dbms_pipe.receive_message
        
        3. BYPASS TECHNIQUES
           - Case variation: SeLeCt
           - Comments: SEL/**/ECT
           - Encoding: %27 for '
           - Double encoding: %2527
           - Unicode: %u0027
        
        4. EXPLOITATION
           - Extract version/user
           - Enumerate tables/columns
           - Dump data
           - File read/write (if privileged)
        """;

    public static final String SSRF = """
        SSRF Testing Guide:
        
        1. COMMON PARAMETERS
           - url, link, src, href, path
           - redirect, callback, return
           - file, document, image
           - proxy, forward, fetch
        
        2. INTERNAL TARGETS
           - localhost, 127.0.0.1, [::1]
           - Internal IPs: 10.x, 172.16-31.x, 192.168.x
           - Cloud metadata:
             AWS: 169.254.169.254
             GCP: metadata.google.internal
             Azure: 169.254.169.254
        
        3. PROTOCOL HANDLERS
           - file:///etc/passwd
           - dict://localhost:11211/
           - gopher://localhost:6379/
           - ftp://internal-server/
        
        4. BYPASS TECHNIQUES
           - URL encoding: %31%32%37%2e%30%2e%30%2e%31
           - Decimal IP: 2130706433 (127.0.0.1)
           - IPv6: [::ffff:127.0.0.1]
           - DNS rebinding
           - Redirect chains
           - URL parser differentials
        
        5. VERIFICATION
           - Use Burp Collaborator for OOB
           - Check for internal service responses
           - Time-based detection
        """;

    public static final String XSS = """
        XSS Testing Guide:
        
        1. CONTEXT IDENTIFICATION
           - HTML body: <tag>INJECTION</tag>
           - HTML attribute: <tag attr="INJECTION">
           - JavaScript: var x = "INJECTION"
           - URL: href="INJECTION"
           - CSS: style="INJECTION"
        
        2. BASIC PAYLOADS
           - <script>alert(1)</script>
           - <img src=x onerror=alert(1)>
           - <svg onload=alert(1)>
           - javascript:alert(1)
           - <body onload=alert(1)>
        
        3. FILTER BYPASS
           - Case: <ScRiPt>
           - Encoding: &#x3c;script&#x3e;
           - Double encoding
           - Null bytes: <scr%00ipt>
           - Tag variations: <svg>, <math>, <details>
           - Event handlers: onfocus, onmouseover, onerror
        
        4. DOM XSS SINKS
           - innerHTML, outerHTML
           - document.write()
           - eval(), setTimeout(), setInterval()
           - location.href, location.hash
           - jQuery: $(), .html(), .append()
        
        5. CSP BYPASS
           - Allowed domains with JSONP
           - Angular/React gadgets
           - Base tag injection
           - Script nonce reuse
        """;

    /**
     * Get template content by vulnerability type name.
     */
    public static String getTemplate(String vulnerabilityType) {
        if (vulnerabilityType == null) return null;
        
        return switch (vulnerabilityType.toUpperCase()) {
            case "CSRF" -> CSRF;
            case "IDOR" -> IDOR;
            case "SQL INJECTION", "SQLI" -> SQL_INJECTION;
            case "SSRF" -> SSRF;
            case "XSS" -> XSS;
            default -> null;
        };
    }

    /**
     * Get all templates combined as a cheatsheet.
     */
    public static String getAllTemplates() {
        return String.join("\n\n---\n\n", CSRF, IDOR, SQL_INJECTION, SSRF, XSS);
    }
}
